# .htaccess for TaskAgent PHP version - Simply.com Compatible
# Root directory configuration

# Enable rewrite engine (check if module is available)
<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # Redirect all API calls to api/index.php
    RewriteRule ^api/(.*)$ api/index.php [L,QSA]
    
    # Serve static files from public directory  
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_URI} ^/(.*\.(js|css|html|png|jpg|jpeg|gif|svg|ico|json|woff|woff2|ttf|eot))$
    RewriteRule ^(.*)$ public/$1 [L]
    
    # Default route to index.html for SPA behavior
    RewriteCond %{REQUEST_FILENAME} !-f  
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_URI} !^/api/
    RewriteRule ^.*$ public/index.html [L]
</IfModule>

# Security headers (if headers module is available)
<IfModule mod_headers.c>
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options SAMEORIGIN
    Header always set X-XSS-Protection "1; mode=block"
    
    # Enable CORS for API
    Header always set Access-Control-Allow-Origin "*"
    Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
    Header always set Access-Control-Allow-Headers "Content-Type, Authorization"
</IfModule>

# Cache control for development
<FilesMatch "\.(js|html|css)$">
    <IfModule mod_headers.c>
        Header set Cache-Control "no-cache, no-store, must-revalidate, max-age=0"
        Header set Pragma "no-cache"
        Header set Expires "0"
    </IfModule>
</FilesMatch>

# Directory access protection
Options -Indexes

# Protect sensitive files
<FilesMatch "\.(php\.bak|sql|conf|log)$">
    Require all denied
</FilesMatch>